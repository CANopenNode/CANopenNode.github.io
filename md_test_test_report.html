<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CANopenDemo: TEST REPORTS</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="CANopenNode.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CANopenDemo
   </div>
   <div id="projectbrief">CANopenNode demo, tutorial and testing</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">TEST REPORTS </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md118"></a>
Complete tests in running CANopen</h1>
<p><code>./test_all.sh</code>, two CAN devices, 250 kbps: </p><div class="fragment"><div class="line">Running &#39;basic_NMT_SDO_heartbeat.bats&#39;:</div>
<div class="line"> ✓ NMT: all preoperational</div>
<div class="line"> ✓ SDO: read heartbeat D1</div>
<div class="line"> ✓ SDO: read heartbeat D2</div>
<div class="line"> ✓ SDO: disable heartbeats</div>
<div class="line"> ✓ candump: no communication, 2sec</div>
<div class="line"> ✓ Heartbeats: all present</div>
<div class="line"> ✓ NMT: reset communication - one</div>
<div class="line"> ✓ NMT: reset communication - two</div>
<div class="line"> ✓ NMT: reset communication - three</div>
<div class="line"> ✓ all preoperational</div>
<div class="line"> ✓ SDO: disable all PDOs on D1</div>
<div class="line"> ✓ SDO: disable all PDOs on D2</div>
<div class="line"> ✓ NMT: pre-operational D1</div>
<div class="line"> ✓ NMT: operational D1</div>
<div class="line"> ✓ NMT: pre-operational D2</div>
<div class="line"> ✓ NMT: operational D2</div>
<div class="line"> ✓ finish: NMT all preoperational</div>
<div class="line"> </div>
<div class="line">17 tests, 0 failures</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Running &#39;heartbeat_consumer.bats&#39;:</div>
<div class="line"> ✓ Start heartbeat producer on D1 only</div>
<div class="line"> ✓ Start heartbeat consumer on D2</div>
<div class="line"> ✓ Heartbeat producer D1 missing</div>
<div class="line"> ✓ Heartbeat producer D1 established</div>
<div class="line"> ✓ Bootup message D1</div>
<div class="line"> ✓ Second HB consumer configuration</div>
<div class="line"> ✓ Illegal HB consumer configuration (duplicate nodeId)</div>
<div class="line"> ✓ Cleanup</div>
<div class="line"> </div>
<div class="line">8 tests, 0 failures</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Running &#39;SDO_transfer.bats&#39;:</div>
<div class="line"> ✓ Segmented write</div>
<div class="line"> ✓ Segmented read</div>
<div class="line"> ✓ Segmented transfer, files equal</div>
<div class="line"> ✓ Block write</div>
<div class="line"> ✓ Block read - 2x</div>
<div class="line"> ✓ Block transfer, files equal</div>
<div class="line"> </div>
<div class="line">   10240 bytes, segmented written/read: 2071/2552 milliseconds.</div>
<div class="line">   10240 bytes, block written/read: 744/744 milliseconds.</div>
<div class="line"> </div>
<div class="line">6 tests, 0 failures</div>
<div class="line"> </div>
<div class="line">Test duration: 13.384309162 sec</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md119"></a>
SDO transfer test reports for different target systems</h1>
<p>Running tests with <code>SDO_transfer.bats</code>, see <a class="elRef" href="CANopenNode/index.html#md_README">test/README.md</a> for preparation of devices.</p>
<h2><a class="anchor" id="autotoc_md120"></a>
Devices tested 2021-05-02</h2>
<ul>
<li>systems:<ul>
<li>Ubuntu 20.10, Linux 5.8.0-41-generic on desktop PC</li>
<li>Raspberry Pi OS 10 (buster) on RPI</li>
</ul>
</li>
<li>canopend, testing SDO client and gateway:<ul>
<li>versions CANopenNode:<ul>
<li>"v4.0-25-g8855820"</li>
<li>"v2.0-6-gacd719e"</li>
</ul>
</li>
</ul>
</li>
<li>demoDevice, testing SDO server<ul>
<li>version CANopenSocket "v4.0-2-geb7d5f3-dirty"</li>
<li>version CANopenNode "v4.0-25-g8855820" (v2.0 was not tested)</li>
</ul>
</li>
<li>CAN interfaces:<ul>
<li>CPC-USB, EMS Dr. Thomas Wuensche</li>
<li>PCAN-USB: PEAK-System PCAN-USB FD v1 fw v3.2.0 (1 channel, FD not used)</li>
<li>USBtin: USBtin EB v2.0 (slcand)</li>
<li>Raspberry Pi 2 (and 4) Model B<ul>
<li><a href="https://www.sg-electronic-systems.com/can-bus-dual-iso-v2-1-shield-for-raspberry/">CAN shield with MCP2515</a></li>
<li>CPC-USB (PCAN-USB didn't work)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md121"></a>
Virtual CAN device</h2>
<p>Test result: </p><div class="fragment"><div class="line">✓ Segmented transfer - set filename for upload</div>
<div class="line">✓ Block transfer, create 100000 bytes long random binaryFile</div>
<div class="line">✓ Block download binaryFile</div>
<div class="line">✓ Block upload to binaryFileReceived - 2x</div>
<div class="line">✓ Block transfer, files equal</div>
<div class="line">✓ Segmented transfer, create 1000 bytes long random binaryFileSeg</div>
<div class="line">✓ Segmented download binaryFileSeg</div>
<div class="line">✓ Segmented upload to binaryFileSegReceived</div>
<div class="line">✓ Segmented transfer, files equal</div>
<div class="line">  100000 bytes block down/upload: 70/145 milliseconds.</div>
<div class="line">  1000 bytes segmented down/upload: 10/24 milliseconds.</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md122"></a>
CAN bus 1000 Kbps</h2>
<p>Test result: </p><div class="fragment"><div class="line">✓ Segmented transfer - set filename for upload</div>
<div class="line">✓ Block transfer, create 100000 bytes long random binaryFile</div>
<div class="line">✓ Block download binaryFile</div>
<div class="line">✓ Block upload to binaryFileReceived - 2x</div>
<div class="line">✓ Block transfer, files equal</div>
<div class="line">✓ Segmented transfer, create 1000 bytes long random binaryFileSeg</div>
<div class="line">✓ Segmented download binaryFileSeg</div>
<div class="line">✓ Segmented upload to binaryFileSegReceived</div>
<div class="line">✓ Segmented transfer, files equal</div>
<div class="line">  100000 bytes block down/upload: 2316/1840 milliseconds.</div>
<div class="line">  1000 bytes segmented down/upload: 254/270 milliseconds.</div>
</div><!-- fragment --> <h3><a class="anchor" id="autotoc_md123"></a>
Notes USBtin</h3>
<p>USBtin interface doesn't work when sending sequence of data. In block transfer it sends first CAN message in sub-block correctly, then there is a mess on the bus. However data was transferred correctly in all test cases, because of the robustness of the block transfer. But communication time is up to 300 times longer. Reception of the sequence of data as well as segmented transfer always works correctly with USBtin.</p>
<h3><a class="anchor" id="autotoc_md124"></a>
Notes Raspberry PI with CAN shield MCP2515</h3>
<p>Raspberry PI shows had problems with CAN overflow with received sequence of data. It couldn't process fast enough and there was socket overflow. RPI sends emergency message and sets error register. Otherwise data transfer was always correct and time to transfer was not significantly longer. With 250 Kbps there were still overflows, but less. Problem was the same, when RPI was demoDevice (multithreaded program) or canopend (single threaded program). Problem was also the same, when using RPI2 or RPI4. But everything works perfectly when using CPC-USB instead of CAN shield with RPI2 or RPI4. </p><div class="fragment"><div class="line">demoDevice: (CO_CANerror_rxMsgError) Socket error msg ID: 0x20000004, Data[0..7]: 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 (can0)</div>
<div class="line">demoDevice: CAN Interface &quot;can0&quot; Rx buffer overflow. Message dropped</div>
<div class="line">canopend: CANopen Emergency message from node 0x04: errorCode=0x0013, errorRegister=0x10, errorBit=0x13, infoCode=0x00000000</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md125"></a>
Notes other</h3>
<p>No problems were detected on other CAN interfaces.</p>
<h2><a class="anchor" id="autotoc_md126"></a>
CAN bus 10 Kbps</h2>
<p>Enlarge SDO timeout and reduce data size: </p><div class="fragment"><div class="line">cocomm &quot;set sdo_timeout 2000&quot;</div>
<div class="line">export binaryFileSize=1000</div>
</div><!-- fragment --><p>Test result: </p><div class="fragment"><div class="line">✓ Segmented transfer - set filename for upload</div>
<div class="line">✓ Block transfer, create 1000 bytes long random binaryFile</div>
<div class="line">✓ Block download binaryFile</div>
<div class="line">✓ Block upload to binaryFileReceived - 2x</div>
<div class="line">✓ Block transfer, files equal</div>
<div class="line">✓ Segmented transfer, create 1000 bytes long random binaryFileSeg</div>
<div class="line">✓ Segmented download binaryFileSeg</div>
<div class="line">✓ Segmented upload to binaryFileSegReceived</div>
<div class="line">✓ Segmented transfer, files equal</div>
<div class="line">  1000 bytes block down/upload: 1741/1731 milliseconds.</div>
<div class="line">  1000 bytes segmented down/upload: 3611/3621 milliseconds.</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md127"></a>
Notes</h3>
<p>USBtin shows the same problems as with 1000 Kbps. All others worked perfectly. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
