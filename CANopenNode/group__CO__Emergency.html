<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CANopenNode: Emergency</title>
<link rel="icon" href="CANopenNode.png" type="image/x-icon" />
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="CANopenNode.png"/></td>
  <td id="projectalign">
   <div id="projectname">CANopenNode
   </div>
   <div id="projectbrief">CANopen protocol stack</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Topics</a> &#124;
<a href="#files">Files</a> &#124;
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Emergency<div class="ingroups"><a class="el" href="group__CO__CANopen__301.html">CANopen_301</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>CANopen Emergency protocol.  
<a href="#details">More...</a></p>
<div id="dynsection-0" onclick="return dynsection.toggleVisibility(this)" class="dynheader closed" style="cursor:pointer;">
  <img id="dynsection-0-trigger" src="closed.png" alt="+"/> Collaboration diagram for Emergency:</div>
<div id="dynsection-0-summary" class="dynsummary" style="display:block;">
</div>
<div id="dynsection-0-content" class="dyncontent" style="display:none;">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__CO__Emergency.svg" width="486" height="135"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="groups" name="groups"></a>
Topics</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CO__errorRegister__t.html">CANopen Error register</a></td></tr>
<tr class="memdesc:group__CO__errorRegister__t"><td class="mdescLeft">&#160;</td><td class="mdescRight"><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CO__EM__errorCode__t.html">CANopen Error code</a></td></tr>
<tr class="memdesc:group__CO__EM__errorCode__t"><td class="mdescLeft">&#160;</td><td class="mdescRight"><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__CO__EM__errorStatusBits__t.html">Error status bits</a></td></tr>
<tr class="memdesc:group__CO__EM__errorStatusBits__t"><td class="mdescLeft">&#160;</td><td class="mdescRight"><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="CO__Emergency_8h.html">CO_Emergency.h</a></td></tr>
<tr class="memdesc:CO__Emergency_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">CANopen Emergency protocol. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCO__EM__fifo__t.html">CO_EM_fifo_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fifo buffer for emergency producer and error history.  <a href="structCO__EM__fifo__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structCO__EM__t.html">CO_EM_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Emergency object.  <a href="structCO__EM__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gab66d4a6daa5f7492704b56a46b135f71" id="r_gab66d4a6daa5f7492704b56a46b135f71"><td class="memItemLeft" align="right" valign="top"><a id="gab66d4a6daa5f7492704b56a46b135f71" name="gab66d4a6daa5f7492704b56a46b135f71"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CO_errorReport</b>(em,  errorBit,  errorCode,  infoCode)&#160;&#160;&#160;<a class="el" href="#ga9221f9f631ead4b6f66cfcff8614ba46">CO_error</a>(em, <a class="el" href="group__CO__dataTypes.html#ga41f9c5fb8b08eb5dc3edce4dcb37fee7">true</a>, errorBit, errorCode, infoCode)</td></tr>
<tr class="memdesc:gab66d4a6daa5f7492704b56a46b135f71"><td class="mdescLeft">&#160;</td><td class="mdescRight">Report error condition, for description of parameters see <a class="el" href="#ga9221f9f631ead4b6f66cfcff8614ba46">CO_error</a>. <br /></td></tr>
<tr class="separator:gab66d4a6daa5f7492704b56a46b135f71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga24e2a9311cf704ec6ed43b0ea730c4a3" id="r_ga24e2a9311cf704ec6ed43b0ea730c4a3"><td class="memItemLeft" align="right" valign="top"><a id="ga24e2a9311cf704ec6ed43b0ea730c4a3" name="ga24e2a9311cf704ec6ed43b0ea730c4a3"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>CO_errorReset</b>(em,  errorBit,  infoCode)&#160;&#160;&#160;<a class="el" href="#ga9221f9f631ead4b6f66cfcff8614ba46">CO_error</a>(em, <a class="el" href="group__CO__dataTypes.html#ga65e9886d74aaee76545e83dd09011727">false</a>, errorBit, <a class="el" href="group__CO__EM__errorCode__t.html#ga529e20206c177d9fff20fe1d5579feb3">CO_EMC_NO_ERROR</a>, infoCode)</td></tr>
<tr class="memdesc:ga24e2a9311cf704ec6ed43b0ea730c4a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset error condition, for description of parameters see <a class="el" href="#ga9221f9f631ead4b6f66cfcff8614ba46">CO_error</a>. <br /></td></tr>
<tr class="separator:ga24e2a9311cf704ec6ed43b0ea730c4a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gab95c4ab9c40fe529bdcbcbe80b69b8dc" id="r_gab95c4ab9c40fe529bdcbcbe80b69b8dc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__CO__driver.html#ga1cb2d3466eb0c6d267f3b5ff1a0d9532">CO_ReturnError_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gab95c4ab9c40fe529bdcbcbe80b69b8dc">CO_EM_init</a> (<a class="el" href="structCO__EM__t.html">CO_EM_t</a> *em, <a class="el" href="structCO__CANmodule__t.html">CO_CANmodule_t</a> *CANdevTx, const <a class="el" href="structOD__entry__t.html">OD_entry_t</a> *OD_1001_errReg, <a class="el" href="structCO__EM__fifo__t.html">CO_EM_fifo_t</a> *fifo, <a class="el" href="group__CO__dataTypes.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> fifoSize, <a class="el" href="structOD__entry__t.html">OD_entry_t</a> *OD_1014_cobIdEm, <a class="el" href="group__CO__dataTypes.html#ga1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a> CANdevTxIdx, <a class="el" href="structOD__entry__t.html">OD_entry_t</a> *OD_1015_InhTime, <a class="el" href="structOD__entry__t.html">OD_entry_t</a> *OD_1003_preDefErr, <a class="el" href="structOD__entry__t.html">OD_entry_t</a> *OD_statusBits, <a class="el" href="structCO__CANmodule__t.html">CO_CANmodule_t</a> *CANdevRx, <a class="el" href="group__CO__dataTypes.html#ga1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a> CANdevRxIdx, const <a class="el" href="group__CO__dataTypes.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> nodeId, <a class="el" href="group__CO__dataTypes.html#ga33594304e786b158f3fb30289278f5af">uint32_t</a> *errInfo)</td></tr>
<tr class="memdesc:gab95c4ab9c40fe529bdcbcbe80b69b8dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize Emergency object.  <br /></td></tr>
<tr class="separator:gab95c4ab9c40fe529bdcbcbe80b69b8dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga94efd78032de3667e2a89780b08aabed" id="r_ga94efd78032de3667e2a89780b08aabed"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga94efd78032de3667e2a89780b08aabed">CO_EM_initCallbackPre</a> (<a class="el" href="structCO__EM__t.html">CO_EM_t</a> *em, void *object, void(*pFunctSignal)(void *object))</td></tr>
<tr class="memdesc:ga94efd78032de3667e2a89780b08aabed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize Emergency callback function.  <br /></td></tr>
<tr class="separator:ga94efd78032de3667e2a89780b08aabed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga583245c954327c3cf7f9fdb97854e76b" id="r_ga583245c954327c3cf7f9fdb97854e76b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga583245c954327c3cf7f9fdb97854e76b">CO_EM_initCallbackRx</a> (<a class="el" href="structCO__EM__t.html">CO_EM_t</a> *em, void(*pFunctSignalRx)(const <a class="el" href="group__CO__dataTypes.html#ga1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a> ident, const <a class="el" href="group__CO__dataTypes.html#ga1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a> errorCode, const <a class="el" href="group__CO__dataTypes.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> errorRegister, const <a class="el" href="group__CO__dataTypes.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> errorBit, const <a class="el" href="group__CO__dataTypes.html#ga33594304e786b158f3fb30289278f5af">uint32_t</a> infoCode))</td></tr>
<tr class="memdesc:ga583245c954327c3cf7f9fdb97854e76b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize Emergency received callback function.  <br /></td></tr>
<tr class="separator:ga583245c954327c3cf7f9fdb97854e76b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga93ae7be6ef966192f5761ce343345d3b" id="r_ga93ae7be6ef966192f5761ce343345d3b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga93ae7be6ef966192f5761ce343345d3b">CO_EM_process</a> (<a class="el" href="structCO__EM__t.html">CO_EM_t</a> *em, <a class="el" href="group__CO__dataTypes.html#ga490ee355f57f2815cb1aa4626cf525f7">bool_t</a> NMTisPreOrOperational, <a class="el" href="group__CO__dataTypes.html#ga33594304e786b158f3fb30289278f5af">uint32_t</a> timeDifference_us, <a class="el" href="group__CO__dataTypes.html#ga33594304e786b158f3fb30289278f5af">uint32_t</a> *timerNext_us)</td></tr>
<tr class="memdesc:ga93ae7be6ef966192f5761ce343345d3b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process Error control and Emergency object.  <br /></td></tr>
<tr class="separator:ga93ae7be6ef966192f5761ce343345d3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9221f9f631ead4b6f66cfcff8614ba46" id="r_ga9221f9f631ead4b6f66cfcff8614ba46"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga9221f9f631ead4b6f66cfcff8614ba46">CO_error</a> (<a class="el" href="structCO__EM__t.html">CO_EM_t</a> *em, <a class="el" href="group__CO__dataTypes.html#ga490ee355f57f2815cb1aa4626cf525f7">bool_t</a> setError, const <a class="el" href="group__CO__dataTypes.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> errorBit, <a class="el" href="group__CO__dataTypes.html#ga1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a> errorCode, <a class="el" href="group__CO__dataTypes.html#ga33594304e786b158f3fb30289278f5af">uint32_t</a> infoCode)</td></tr>
<tr class="memdesc:ga9221f9f631ead4b6f66cfcff8614ba46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set or reset error condition.  <br /></td></tr>
<tr class="separator:ga9221f9f631ead4b6f66cfcff8614ba46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8e9bae71814a3e7bbd8d59d721174c2b" id="r_ga8e9bae71814a3e7bbd8d59d721174c2b"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="group__CO__dataTypes.html#ga490ee355f57f2815cb1aa4626cf525f7">bool_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga8e9bae71814a3e7bbd8d59d721174c2b">CO_isError</a> (<a class="el" href="structCO__EM__t.html">CO_EM_t</a> *em, const <a class="el" href="group__CO__dataTypes.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> errorBit)</td></tr>
<tr class="memdesc:ga8e9bae71814a3e7bbd8d59d721174c2b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check specific error condition.  <br /></td></tr>
<tr class="separator:ga8e9bae71814a3e7bbd8d59d721174c2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf0c47186d9e51fb91d48385a9f6bad6b" id="r_gaf0c47186d9e51fb91d48385a9f6bad6b"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="group__CO__dataTypes.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#gaf0c47186d9e51fb91d48385a9f6bad6b">CO_getErrorRegister</a> (<a class="el" href="structCO__EM__t.html">CO_EM_t</a> *em)</td></tr>
<tr class="memdesc:gaf0c47186d9e51fb91d48385a9f6bad6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get error register.  <br /></td></tr>
<tr class="separator:gaf0c47186d9e51fb91d48385a9f6bad6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>CANopen Emergency protocol. </p>
<p>Error control and Emergency is used for control internal error state and for sending a CANopen Emergency message.</p>
<p>In case of error condition stack or application calls <a class="el" href="#gab66d4a6daa5f7492704b56a46b135f71" title="Report error condition, for description of parameters see CO_error.">CO_errorReport()</a> function with indication of the error. Specific error condition is reported (with CANopen Emergency message) only the first time after it occurs. Internal state of specific error condition is indicated by internal bitfield variable, with space for maximum <a class="el" href="group__CO__STACK__CONFIG__EMERGENCY.html#gab87776d4802748671b234112263760af">CO_CONFIG_EM_ERR_STATUS_BITS_COUNT</a> bits. Meaning for each bit is described by <a class="el" href="group__CO__EM__errorStatusBits__t.html">Error status bits</a>. Specific error condition can be reset by <a class="el" href="#ga24e2a9311cf704ec6ed43b0ea730c4a3" title="Reset error condition, for description of parameters see CO_error.">CO_errorReset()</a> function. In that case Emergency message is sent with CO_EM_NO_ERROR indication.</p>
<p>Some error conditions are informative and some are critical. Critical error conditions set the corresponding bit in <a class="el" href="group__CO__errorRegister__t.html">CANopen Error register</a>. Critical error conditions for generic error are specified by <a class="el" href="group__CO__STACK__CONFIG__EMERGENCY.html#gad6270eb7887b22c0365c304d7cf2c633">CO_CONFIG_ERR_CONDITION_GENERIC</a> macro. Similar macros are defined for other error bits in in <a class="el" href="group__CO__errorRegister__t.html">CANopen Error register</a>.</p>
<h3><a class="anchor" id="autotoc_md134"></a>
Emergency producer</h3>
<p>If <a class="el" href="group__CO__STACK__CONFIG__EMERGENCY.html#ga16aa1479ffd52a627d1053c20f844b62">CO_CONFIG_EM</a> has CO_CONFIG_EM_PRODUCER enabled, then CANopen Emergency message will be sent on each change of any error condition. Emergency message contents are:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Byte   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0..1   </td><td class="markdownTableBodyNone"><a class="el" href="group__CO__EM__errorCode__t.html">CANopen Error code</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone"><a class="el" href="group__CO__errorRegister__t.html">CANopen Error register</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">Index of error condition (see <a class="el" href="group__CO__EM__errorStatusBits__t.html">Error status bits</a>).    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4..7   </td><td class="markdownTableBodyNone">Additional informative argument to <a class="el" href="#gab66d4a6daa5f7492704b56a46b135f71" title="Report error condition, for description of parameters see CO_error.">CO_errorReport()</a> function.   </td></tr>
</table>
<h3><a class="anchor" id="autotoc_md135"></a>
Error history</h3>
<p>If <a class="el" href="group__CO__STACK__CONFIG__EMERGENCY.html#ga16aa1479ffd52a627d1053c20f844b62">CO_CONFIG_EM</a> has CO_CONFIG_EM_HISTORY enabled, then latest errors can be read from <em>Pre Defined Error Field</em> (object dictionary, index 0x1003). Contents corresponds to bytes 0..3 from the Emergency message.</p>
<h3><a class="anchor" id="autotoc_md136"></a>
Emergency consumer</h3>
<p>If <a class="el" href="group__CO__STACK__CONFIG__EMERGENCY.html#ga16aa1479ffd52a627d1053c20f844b62">CO_CONFIG_EM</a> has CO_CONFIG_EM_CONSUMER enabled, then callback can be registered by <a class="el" href="#ga583245c954327c3cf7f9fdb97854e76b">CO_EM_initCallbackRx()</a> function. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="gab95c4ab9c40fe529bdcbcbe80b69b8dc" name="gab95c4ab9c40fe529bdcbcbe80b69b8dc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab95c4ab9c40fe529bdcbcbe80b69b8dc">&#9670;&#160;</a></span>CO_EM_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__CO__driver.html#ga1cb2d3466eb0c6d267f3b5ff1a0d9532">CO_ReturnError_t</a> CO_EM_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCO__EM__t.html">CO_EM_t</a> *</td>          <td class="paramname"><span class="paramname"><em>em</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structCO__CANmodule__t.html">CO_CANmodule_t</a> *</td>          <td class="paramname"><span class="paramname"><em>CANdevTx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structOD__entry__t.html">OD_entry_t</a> *</td>          <td class="paramname"><span class="paramname"><em>OD_1001_errReg</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structCO__EM__fifo__t.html">CO_EM_fifo_t</a> *</td>          <td class="paramname"><span class="paramname"><em>fifo</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__CO__dataTypes.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a></td>          <td class="paramname"><span class="paramname"><em>fifoSize</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structOD__entry__t.html">OD_entry_t</a> *</td>          <td class="paramname"><span class="paramname"><em>OD_1014_cobIdEm</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__CO__dataTypes.html#ga1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a></td>          <td class="paramname"><span class="paramname"><em>CANdevTxIdx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structOD__entry__t.html">OD_entry_t</a> *</td>          <td class="paramname"><span class="paramname"><em>OD_1015_InhTime</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structOD__entry__t.html">OD_entry_t</a> *</td>          <td class="paramname"><span class="paramname"><em>OD_1003_preDefErr</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structOD__entry__t.html">OD_entry_t</a> *</td>          <td class="paramname"><span class="paramname"><em>OD_statusBits</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structCO__CANmodule__t.html">CO_CANmodule_t</a> *</td>          <td class="paramname"><span class="paramname"><em>CANdevRx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__CO__dataTypes.html#ga1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a></td>          <td class="paramname"><span class="paramname"><em>CANdevRxIdx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__CO__dataTypes.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a></td>          <td class="paramname"><span class="paramname"><em>nodeId</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__CO__dataTypes.html#ga33594304e786b158f3fb30289278f5af">uint32_t</a> *</td>          <td class="paramname"><span class="paramname"><em>errInfo</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize Emergency object. </p>
<p>Function must be called in the communication reset section.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">em</td><td>This object will be initialized. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">fifo</td><td>Fifo buffer for emergency producer and error history. It must be defined externally. Its size must be capacity+1. See also <a class="el" href="structCO__EM__t.html">CO_EM_t</a>, fifo. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">fifoSize</td><td>Size of the above fifo buffer. It is usually equal to the length of the OD array 0x1003 + 1. If fifoSize is smaller than 2, then emergency producer and error history will not work and 'fifo' may be NULL. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">CANdevTx</td><td>CAN device for Emergency transmission. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">OD_1001_errReg</td><td>OD entry for 0x1001 - "Error register", entry is required, without IO extension. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">OD_1014_cobIdEm</td><td>OD entry for 0x1014 - "COB-ID EMCY", entry is required, IO extension is required. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">CANdevTxIdx</td><td>Index of transmit buffer in the above CAN device. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">OD_1015_InhTime</td><td>OD entry for 0x1015 - "Inhibit time EMCY", entry is optional (can be NULL), IO extension is optional for runtime configuration. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">OD_1003_preDefErr</td><td>OD entry for 0x1003 - "Pre-defined error field". Emergency object has own memory buffer for this entry. Entry is optional, IO extension is required. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">OD_statusBits</td><td>Custom OD entry for accessing errorStatusBits from <a class="el" href="structCO__EM__t.html">CO_EM_t</a>. Entry must have variable of size (CO_CONFIG_EM_ERR_STATUS_BITS_COUNT/8) bytes available for read/write access on subindex 0. Emergency object has own memory buffer for this entry. Entry is optional, IO extension is required. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">CANdevRx</td><td>CAN device for Emergency consumer reception. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">CANdevRxIdx</td><td>Index of receive buffer in the above CAN device. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">nodeId</td><td>CANopen node ID of this device (for default emergency producer) </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">errInfo</td><td>Additional information in case of error, may be NULL.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="group__CO__driver.html#ga1cb2d3466eb0c6d267f3b5ff1a0d9532">CO_ReturnError_t</a> CO_ERROR_NO in case of success. </dd></dl>

</div>
</div>
<a id="ga94efd78032de3667e2a89780b08aabed" name="ga94efd78032de3667e2a89780b08aabed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga94efd78032de3667e2a89780b08aabed">&#9670;&#160;</a></span>CO_EM_initCallbackPre()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CO_EM_initCallbackPre </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCO__EM__t.html">CO_EM_t</a> *</td>          <td class="paramname"><span class="paramname"><em>em</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>object</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*</td>          <td class="paramname"><span class="paramname"><em>pFunctSignal&#160;</em></span>)(void *object)&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize Emergency callback function. </p>
<p>Function initializes optional callback function, which should immediately start processing of <a class="el" href="#ga93ae7be6ef966192f5761ce343345d3b" title="Process Error control and Emergency object.">CO_EM_process()</a> function. Callback is called from <a class="el" href="#gab66d4a6daa5f7492704b56a46b135f71" title="Report error condition, for description of parameters see CO_error.">CO_errorReport()</a> or <a class="el" href="#ga24e2a9311cf704ec6ed43b0ea730c4a3" title="Reset error condition, for description of parameters see CO_error.">CO_errorReset()</a> function. Those functions are fast and may be called from any thread. Callback should immediately start mainline thread, which calls <a class="el" href="#ga93ae7be6ef966192f5761ce343345d3b" title="Process Error control and Emergency object.">CO_EM_process()</a> function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">em</td><td>This object. </td></tr>
    <tr><td class="paramname">object</td><td>Pointer to object, which will be passed to pFunctSignal(). Can be NULL </td></tr>
    <tr><td class="paramname">pFunctSignal</td><td>Pointer to the callback function. Not called if NULL. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga583245c954327c3cf7f9fdb97854e76b" name="ga583245c954327c3cf7f9fdb97854e76b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga583245c954327c3cf7f9fdb97854e76b">&#9670;&#160;</a></span>CO_EM_initCallbackRx()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CO_EM_initCallbackRx </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCO__EM__t.html">CO_EM_t</a> *</td>          <td class="paramname"><span class="paramname"><em>em</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*</td>          <td class="paramname"><span class="paramname"><em>pFunctSignalRx&#160;</em></span>)(const <a class="el" href="group__CO__dataTypes.html#ga1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a> ident, const <a class="el" href="group__CO__dataTypes.html#ga1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a> errorCode, const <a class="el" href="group__CO__dataTypes.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> errorRegister, const <a class="el" href="group__CO__dataTypes.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> errorBit, const <a class="el" href="group__CO__dataTypes.html#ga33594304e786b158f3fb30289278f5af">uint32_t</a> infoCode)&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize Emergency received callback function. </p>
<p>Function initializes optional callback function, which executes after error condition is received.</p>
<p><em>ident</em> argument from callback contains CAN-ID of the emergency message. If <em>ident</em> == 0, then emergency message was sent from this device.</p>
<dl class="section remark"><dt>Remarks</dt><dd>Depending on the CAN driver implementation, this function is called inside an ISR or inside a mainline. Must be thread safe.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">em</td><td>This object. </td></tr>
    <tr><td class="paramname">pFunctSignalRx</td><td>Pointer to the callback function. Not called if NULL. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga93ae7be6ef966192f5761ce343345d3b" name="ga93ae7be6ef966192f5761ce343345d3b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga93ae7be6ef966192f5761ce343345d3b">&#9670;&#160;</a></span>CO_EM_process()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CO_EM_process </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCO__EM__t.html">CO_EM_t</a> *</td>          <td class="paramname"><span class="paramname"><em>em</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__CO__dataTypes.html#ga490ee355f57f2815cb1aa4626cf525f7">bool_t</a></td>          <td class="paramname"><span class="paramname"><em>NMTisPreOrOperational</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__CO__dataTypes.html#ga33594304e786b158f3fb30289278f5af">uint32_t</a></td>          <td class="paramname"><span class="paramname"><em>timeDifference_us</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__CO__dataTypes.html#ga33594304e786b158f3fb30289278f5af">uint32_t</a> *</td>          <td class="paramname"><span class="paramname"><em>timerNext_us</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Process Error control and Emergency object. </p>
<p>Function must be called cyclically. It verifies some communication errors, calculates OD object 0x1001 - "Error
register" and sends emergency message if necessary.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">em</td><td>This object. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">NMTisPreOrOperational</td><td>True if this node is NMT_PRE_OPERATIONAL or NMT_OPERATIONAL state. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">timeDifference_us</td><td>Time difference from previous function call in [microseconds]. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">timerNext_us</td><td>info to OS - see <a class="el" href="group__CO__CANopen.html#ga895d7fad40b60aacdac3cb0615729b5e" title="Process CANopen objects.">CO_process()</a>. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga9221f9f631ead4b6f66cfcff8614ba46" name="ga9221f9f631ead4b6f66cfcff8614ba46"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9221f9f631ead4b6f66cfcff8614ba46">&#9670;&#160;</a></span>CO_error()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CO_error </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCO__EM__t.html">CO_EM_t</a> *</td>          <td class="paramname"><span class="paramname"><em>em</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__CO__dataTypes.html#ga490ee355f57f2815cb1aa4626cf525f7">bool_t</a></td>          <td class="paramname"><span class="paramname"><em>setError</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__CO__dataTypes.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a></td>          <td class="paramname"><span class="paramname"><em>errorBit</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__CO__dataTypes.html#ga1f1825b69244eb3ad2c7165ddc99c956">uint16_t</a></td>          <td class="paramname"><span class="paramname"><em>errorCode</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__CO__dataTypes.html#ga33594304e786b158f3fb30289278f5af">uint32_t</a></td>          <td class="paramname"><span class="paramname"><em>infoCode</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set or reset error condition. </p>
<p>Function can be called on any error condition inside CANopen stack or application. Function first checks change of error condition (setError is true and error bit wasn't set or setError is false and error bit was set before). If changed, then Emergency message is prepared and record in history is added. Emergency message is later sent by <a class="el" href="#ga93ae7be6ef966192f5761ce343345d3b" title="Process Error control and Emergency object.">CO_EM_process()</a> function.</p>
<p>Function is short and thread safe.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">em</td><td>Emergency object. </td></tr>
    <tr><td class="paramname">setError</td><td>True if error occurred or false if error resolved. </td></tr>
    <tr><td class="paramname">errorBit</td><td>from <a class="el" href="group__CO__EM__errorStatusBits__t.html">Error status bits</a>. </td></tr>
    <tr><td class="paramname">errorCode</td><td>from <a class="el" href="group__CO__EM__errorCode__t.html">CANopen Error code</a>. </td></tr>
    <tr><td class="paramname">infoCode</td><td>32 bit value is passed to bytes 4...7 of the Emergency message. It contains optional additional information. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga8e9bae71814a3e7bbd8d59d721174c2b" name="ga8e9bae71814a3e7bbd8d59d721174c2b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8e9bae71814a3e7bbd8d59d721174c2b">&#9670;&#160;</a></span>CO_isError()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="group__CO__dataTypes.html#ga490ee355f57f2815cb1aa4626cf525f7">bool_t</a> CO_isError </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCO__EM__t.html">CO_EM_t</a> *</td>          <td class="paramname"><span class="paramname"><em>em</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__CO__dataTypes.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a></td>          <td class="paramname"><span class="paramname"><em>errorBit</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Check specific error condition. </p>
<p>Function returns true, if specific internal error is present.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">em</td><td>Emergency object. </td></tr>
    <tr><td class="paramname">errorBit</td><td>from <a class="el" href="group__CO__EM__errorStatusBits__t.html">Error status bits</a>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if Error is present. </dd></dl>

</div>
</div>
<a id="gaf0c47186d9e51fb91d48385a9f6bad6b" name="gaf0c47186d9e51fb91d48385a9f6bad6b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaf0c47186d9e51fb91d48385a9f6bad6b">&#9670;&#160;</a></span>CO_getErrorRegister()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="group__CO__dataTypes.html#gaba7bc1797add20fe3efdf37ced1182c5">uint8_t</a> CO_getErrorRegister </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structCO__EM__t.html">CO_EM_t</a> *</td>          <td class="paramname"><span class="paramname"><em>em</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get error register. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">em</td><td>Emergency object.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error register or 0 if doesn't exist. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
